name: 'Daily Photo Sync'

on:
    schedule:
        - cron: '0 0 * * *' # Runs at midnight everyday
    workflow_dispatch: # Allows you to click "Run Now" manually for testing

jobs:
    update-data:
        runs-on: ubuntu-latest
        permissions:
            contents: write # Crucial! Allows the robot to commit changes

        steps:
            - name: Check out repo
              uses: actions/checkout@v4

            - name: Set up Python
              uses: actions/setup-python@v4
              with:
                  python-version: '3.12'

            - name: Install dependencies
              run: |
                  pip install requests python-dotenv

            - name: Run ETL Script
              env:
                  UNSPLASH_ACCESS_KEY: ${{ secrets.UNSPLASH_ACCESS_KEY }}
                  UNSPLASH_USERNAME: ${{ secrets.UNSPLASH_USERNAME }}
              run: python backend/etl.py

            - name: Commit and Push if changed
              run: |
                  git config user.name "GitHub Action"
                  git config user.email "action@github.com"
                  git add data/photos.db
                  # Only commit if the database actually changed
                  git diff --quiet && git diff --staged --quiet || (git commit -m "ðŸ“¸ Update photo database - $(date +'%Y-%m-%d')" && git push)
